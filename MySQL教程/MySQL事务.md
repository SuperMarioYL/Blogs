# MySQL事务

<!-- TOC -->

- [事务必须具备的属性](#事务必须具备的属性)
- [事务并发可能出现的问题](#事务并发可能出现的问题)
- [事务的4个隔离级别](#事务的4个隔离级别)
- [事务的开启、关闭和回滚](#事务的开启关闭和回滚)

<!-- /TOC -->

---
## 事务必须具备的属性

- `原子性` 事务里的操作要么都执行，要么都不执行
- `一致性` 在事务执行时，数据必须是一致的
- `隔离性` 并发的事务应该互不影响
- `永久性` 事务执行完后，对数据的修改应该持久化

---
## 事务并发可能出现的问题

|问题|前提|举例|
|:--|:--|:--|
|脏读|A事务可以读取B事务没有提交的数据|A事务读取了B事务修改的数据，而B事务回滚了，则A事务读取到的数据就在数据库中不存在，称作脏读|
|不可重复读|A事务可以 `Update` B事务影响的行|A事务在两次读取之间被B事务修改了数据，导致A事务两次读取同一数据的结果不同|
|幻读|A事务可以`Insert/Delete` B事务影响的行|A事务两次读取影响的行数之间被B事务删掉了几行或新增了几行，导致两次select读取的行数不一样，被称为幻读|

---
## 事务的4个隔离级别

由上之下隔离级别依次提高

|名称|中文简称|脏读|不可重复读|幻读|描述|
|:--|:--|:-:|:-:|:-:|:--|
| `Read Uncommited`|读未提交|是|是|是|A事务可以读取B事务没有提交的数据|
| `Read Commited`|不可重复读（读已提交）|否|是|是|事务只能读取已提交的数据|
| `Repeatable Read`|可重复读（MySQL默认隔离级别）|否|否|是|查询时受影响的行不允许修改（MySQL通过MVCC在可重复读等级解决了幻读）|
| `Serialization`|串行化|否|否|否|只允许并发一个事务|

---
## 事务的开启、关闭和回滚

- 开启事务 `begin`
- 回滚事务 `rollback`
- 提交事务 `commit`